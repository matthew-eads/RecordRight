See https://www.twilio.com/docs/quickstart/python/sms

I'm using virtualenv: see http://docs.python-guide.org/en/latest/dev/virtualenvs/
and I have a requirements file I'll try to keep up to date, so you can just 
pip install -r requirements.txt once you're in your venv

There seem to be two ways to use the API:
  1. Manually send/receive messages, we repeatedly 
     query the server for any incoming messages, and
     for each one, we process it, and manually send 
     a response.
  2. Create a server which will respond to HTTP requests, 
     a GET request from twilio will contain an SMS we are
     receiving, and then we send back a message to twilio.

Both are pretty simple, but I'm leaning towards working with 
the first method for now. It should be simple enough to switch though. 

EDIT: scratch that, on further research, it seems making some sort of server
is the best solution.

To make life easier, I've created Phone.py, which is a simple little script
to simulate sending/receiving texts. Basically, it connects with the 
Flask app Server.py on localhost. It then reads messages from stdin,
which it formats as a POST request and then sends them to the server,
and then prints the response. It tries to look just like the requests
that Twilio sends, so our server doesn't actually know if its sending 
messages to twilio, or just to our testing service. Because of this,
the server sends back xml responses, so we have to do a quick parsing of
the xml to make it a bit more readable.

Currently the server is very simple, it sets up a basic Flask app
which will receive GET/POST requests, and send back a Twilio-xml
formatted response.

I did a couple quick tests using my phone, and it does work! But its
a bit of a pain to make it available to the outside web, but once we 
have a more useful prototype we can spin off some heroku website or similar
and test it properly.

--------------------------------------------------------------------------------
I've now set up a heroku app to handle this. From the root (RecordRight/, not RRSMS/),
you can `git subtree push --prefix RRSMS heroku master`, which should be all you need
to do. Navigating to record-right.herokuapp.com should show a brief error message,
but you should be able to text the twilio number and get an actual response.
`heroku logs` shows the logs
`heroku ps` should show whether or not anything is running,
if not `heroku scale web=1` should spin it up.
`heroku domains` will show where it lives, and `heroku open` will open it in a browser.
`heroku run bash` is a useful way to debug manually if needed.
All this requires installing heroku, but there are easy guides on their website.

Procfile tells heroku how to run the app - right now it just runs python Server.py,
but in the future there are much better ways to deploy it for ~~production~~.

--------------------------------------------------------------------------------

So now we need to come up with a texting interface. In general there are only 
a couple things we want people to do: fetch existing data from their record,
and update that data. 

To fetch:

-------------------------------------------------------------help
Welcome to RecordRight, <patient_name>---------------------------
text '1' to fetch information from your record,------------------
'2' to update information in your record,------------------------
or '3' for more help.--------------------------------------------
----------------------------------------------------------------1
For notes from your recent visit, send '1',----------------------
for recent test results, send '2', to seach----------------------
for a different field, send '3' followed by the------------------
name of the field. Send '9' to quit this transaction.------------
----------------------------------------------------------------1
<RECENT NOTES>
Thanks, byeee.

So to keep track of a conversation, and where someone is in the
menu, we basically need to create a flowchart for each possible
interaction, and then enumerate each state. This number can
then be easily stored in the session cookie (which twilio stores
for us), and then used to determine what to do. 

For example, our process_message function would take in a couple
arguments, the message and the session 'number'

----------------------------------------------------------------------------------
Here is an enumeration of menu states:
0: New message from existing patient
1: Patient responds to welcome message - either asks to fetch or update
2: Fetch, message should contain field to retrieve
3: Update, message should contain field to update
4: Update, message should contain new value for the field

9: New message from unknown number - we want to register a new patient
10: Patient texts back full name
11: Found a match, ask to confirm by texting birth date
12: No match :( Tell them to contact hospital?
13: Text back dob, either tell them its wrong and try again, or its
    a match, and we go to menu state 1

Here is the flowchart of menu states:





                |-1
       |-11--13-|
9--10--|        |-13
       |-12


     |-2
0--1-|-1
     |-3-4